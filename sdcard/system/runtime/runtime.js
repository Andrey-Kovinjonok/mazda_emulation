/**
 * Custom Application SDK for Mazda Connect Infotainment System
 * 
 * A micro framework that allows to write custom applications for the Mazda Connect Infotainment System
 * that includes an easy to use abstraction layer to the JCI system.
 *
 * Written by Andreas Schwarz (http://github.com/flyandi/mazda-custom-applications-sdk)
 * Copyright (c) 2016. All rights reserved.
 * 
 * WARNING: The installation of this application requires modifications to your Mazda Connect system.
 * If you don't feel comfortable performing these changes, please do not attempt to install this. You might
 * be ending up with an unusuable system that requires reset by your Dealer. You were warned!
 *
 * This program is free software: you can redistribute it and/or modify it under the terms of the 
 * GNU General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even 
 * the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 * 
 * You should have received a copy of the GNU General Public License along with this program. 
 * If not, see http://www.gnu.org/licenses/
 *
 */

/**
 * This is the main mini framework file that contains everything to run the custom application environment
 */

var CUSTOM_APPLICATION_VERSION='0.0.4';var CustomApplication=function(){function t(t){Object.keys(t).map(function(e){this[e]||(this[e]=t[e])}.bind(this))}return t.prototype={ANY:0,CHANGED:1,GREATER:2,LESSER:3,EQUAL:4,FOCUSED:"focused",LOST:"lost",LEFT:"leftStart",RIGHT:"rightStart",UP:"upStart",DOWN:"downStart",SELECT:"selectStart",CW:"cw",CCW:"ccw",__log:function(){this.log={__logId:this.getId(),__toArray:function(t){var e=Array.apply(null,t);return e.unshift(this.__logId),e},debug:function(){CustomApplicationLog.debug.apply(CustomApplicationLog,this.__toArray(arguments))},info:function(){CustomApplicationLog.info.apply(CustomApplicationLog,this.__toArray(arguments))},error:function(){CustomApplicationLog.error.apply(CustomApplicationLog,this.__toArray(arguments))}}},__initialize:function(t){var e=this;this.__version=CUSTOM_APPLICATION_VERSION,this.__subscriptions={},this.__storage={},this.__contextCounter=0,this.__currentContextIndex=!1,this.is=CustomApplicationHelpers.is(),this.sprintr=CustomApplicationHelpers.sprintr,this.__log(),this.__contexts=[],this.settings=this.settings?this.settings:{},this.subscribe(VehicleData.general.region,function(t,e){this.setRegion(t)}.bind(this),this.CHANGED),this.__region=CustomApplicationDataHandler.get(VehicleData.general.region,"na").value,this.__loaded=!1,this.__load(function(){this.__loaded=!0,this.__getstorage(),this.canvas=$("<div/>").addClass("CustomApplicationCanvas").attr("app",this.id),this.canvas.on("click touchend","[contextIndex]",function(){e.__setCurrentContext($(this).attr("contextIndex"))}),this.__created=!0,this.__lifecycle("created"),this.__initialized=!0,this.is.fn(t)&&t()}.bind(this))},__load:function(t){var e=0,i=0,n=function(n){this.log.debug("Status update for loading resources",{loaded:e,toload:i});var n=n===!0||e==i;n&&this.is.fn(t)&&t()}.bind(this);return this.is.object(this.require)&&!this.__loaded?(this.require.js&&!this.is.empty(this.require.js)&&(i++,CustomApplicationResourceLoader.loadJavascript(this.require.js,this.location,function(){e++,n()})),this.require.css&&!this.is.empty(this.require.css)&&(i++,CustomApplicationResourceLoader.loadCSS(this.require.css,this.location,function(){e++,n()})),void(this.require.images&&!this.is.empty(this.require.images)&&(i++,CustomApplicationResourceLoader.loadImages(this.require.images,this.location,function(t){this.images=t,e++,n()}.bind(this))))):void n(!0)},__wakeup:function(t){return this.__initialized?(this.__getstorage(),this.__lifecycle("focused"),this.canvas.appendTo(t),void setTimeout(function(){this.__measureContext()}.bind(this),25)):this.__initialize(function(){this.__wakeup(t)}.bind(this))},__sleep:function(){this.canvas&&this.canvas.detach(),this.__setstorage(),this.__lifecycle("lost"),this.getSetting("terminateOnLost")===!0&&this.__terminate()},__terminate:function(){this.__lifecycle("terminated"),this.canvas.remove(),this.canvas=null,this.__initialized=!1},__handleControllerEvent:function(t){if(this.log.info("Received Multicontroller Event",{eventId:t}),this.__processContext(t))return!0;if(this.is.fn(this.onControllerEvent))try{return this.onControllerEvent(t),!0}catch(e){}return!1},__lifecycle:function(t){try{switch(this.log.info("Executing lifecycle",{lifecycle:t}),t){case this.FOCUSED:$.each(this.__subscriptions,function(t,e){this.__notify(t,CustomApplicationDataHandler.get(t),!0)}.bind(this))}this.is.fn(this[t])&&this[t]()}catch(e){this.log.error("Error while executing lifecycle event",{lifecycle:t,error:e.message})}},__notify:function(t,e,i){if(t=t.toLowerCase(),this.__subscriptions[t]&&e){var n=this.__subscriptions[t],s=!1;switch(n.type){case this.CHANGED:s=e.changed;break;case this.GREATER:s=e.value>e.previous;break;case this.LESSER:s=e.value<e.previous;break;case this.EQUAL:s=e.value==e.previous;break;default:s=!0}i&&(s=!0),s&&n.callback(e.value,$.extend({},this.__subscriptions[t],e))}},getSetting:function(t,e){return this.settings[t]?this.settings[t]:e?e:!1},getId:function(){return this.id},getTitle:function(){return this.getSetting("title")},getStatusbar:function(){return this.getSetting("statusbar")},getStatusbarTitle:function(){return this.getSetting("statusbarTitle")||this.getTitle()},getStatusbarIcon:function(){var t=this.getSetting("statusbarIcon");return t===!0&&(t=this.location+"app.png"),t},getStatusbarHomeButton:function(){return this.getSetting("statusbarHideHomeButton")!==!0},getHasLeftButton:function(){return this.getSetting("hasLeftButton")},getHasRightArc:function(){return this.getSetting("hasRightArc")},getHasMenuCaret:function(){return this.getSetting("hasMenuCaret")},getRegion:function(){return this.__region||"na"},getStorage:function(){return this.__storage},setRegion:function(t){this.__region!=t&&(this.__region=t,this.is.fn(this.onRegionChange)&&this.onRegionChange(t))},get:function(t,e){return this.__storage&&this.is.defined(this.__storage[t])?this.__storage[t]:e},__getstorage:function(){try{this.__storage=JSON.parse(localStorage.getItem(this.getId()))}catch(t){this.log.error("Could not get storage",{message:t.message})}},set:function(t,e){this.__storage[t]=e,this.__setstorage()},__setstorage:function(){try{this.__storage||(this.__storage={}),localStorage.setItem(this.getId(),JSON.stringify(this.__storage))}catch(t){this.log.error("Could not set storage",{message:t.message})}},subscribe:function(t,e,i){if(this.is.fn(e)){var n={};if(this.is.object(t)&&(n=t,t=n.id||!1),t)return t=t.toLowerCase(),this.__subscriptions[t]=$.extend({},n,{id:t,type:i||this.CHANGED,callback:e}),!0}return!1},unsubscribe:function(t){t=t.toLowerCase(),this.__subscriptions[t]&&(this.__subscriptions[t]=!1)},removeSubscriptions:function(){this.__subscriptions={}},transformValue:function(t,e){return this.is.fn(e)?e(t):t},element:function(t,e,i,n,s,a){var o=$(document.createElement(t)).attr(e?{id:e}:{}).addClass(i).css(n?n:{}).append(s);return a||this.canvas.append(o),o},addContext:function(t,e){switch(!0){case t.nodeName:t=$(content);break;case t instanceof jQuery:break;default:return!1}return t.attr("contextIndex",this.__contextCounter||0),this.__contexts.push({index:this.__contextCounter,callback:e}),this.__contextCounter+=1,t},__measureContext:function(){$.each(this.__contexts,function(t,e){var i=this.canvas.find(this.sprintr("[contextIndex={0}]",e.index));if(!i.length)return!1;this.__contexts[t]=$.extend({},this.__contexts[t],{boundingBox:$.extend({},i.offset(),{width:i.outerWidth(),height:i.outerHeight(),bottom:i.offset().top+i.outerHeight(),right:i.offset().left+i.outerWidth()}),enabled:!0});var n=this.__contexts[t].boundingBox;$.each(this.__contexts,function(e,i){if(e!=t&&i.boundingBox){var s=i.boundingBox;if(n.left<=s.right&&s.left<=n.right&&n.top<=s.bottom&&s.top<=n.bottom)return this.__contexts[t].enabled=!1,!1}}.bind(this))}.bind(this)),this.__currentContextIndex===!1&&this.__contexts.length&&this.__setCurrentContext(this.__contexts[0].index)},__processContext:function(t,e){if(!this.__contexts.length||this.__currentContextIndex===!1)return!1;this.log.debug("Context received new event",{eventId:t,index:this.__currentContextIndex});var i=!1,n=!1,s=this.__contexts[this.__currentContextIndex],a=s.boundingBox,o=function(t,e,s,a){var o=a?t-e:e-t;o>=0&&(n===!1||n>o)&&(n=o,i=s)};return $.each(this.__contexts,function(e,i){if(e!=this.__currentContextIndex){var n=i.boundingBox;if(a&&n)switch(t){case this.RIGHT:o(a.right,n.left,e);break;case this.LEFT:o(a.left,n.right,e,!0);break;case this.UP:o(a.top,n.bottom,e,!0);break;case this.DOWN:o(a.bottom,n.top,e)}}}.bind(this)),i!==!1?(this.__setCurrentContext(i),!0):!1},__setCurrentContext:function(t){var e=this.is.fn(this.onContextEvent);if(this.__currentContextIndex!==!1){var i=this.__contexts[this.__currentContextIndex],n=this.canvas.find(this.sprintr("[contextIndex={0}]",this.__currentContextIndex));if(i&&n.length){var s=!1;this.is.fn(i.callback)&&(s=i.callback.call(this,this.LOST,i,n)),!s&&e&&this.onContextEvent(this.LOST,i,n),this.log.info("Context lost focus",{contextIndex:i.index})}}this.canvas.find("[context]").attr("context","lost");var n=this.canvas.find(this.sprintr("[contextIndex={0}]",t)),a=this.__contexts[t];if(a&&n.length){n.attr("context","focused");var s=!1;this.is.fn(a.callback)&&(s=a.callback.call(this,this.FOCUSED,a,n)),!s&&e&&this.onContextEvent(this.FOCUSED,a,n),this.log.info("Context gained focus",{contextIndex:a.index})}this.__currentContextIndex=t},scrollElement:function(t,e,i,n){var e=t.scrollTop()+e;t.scrollTop(e),n(t.scrollTop())},requireInternet:function(){}},t}(),VehicleDataBrand={7:"Mazda"},VehicleDataVehicleType={18:"MX-5",109:"3 Sport",110:"3 Touring",111:"3 Grand Touring",112:"6 Sport",113:"6 Touring",114:"6 Grand Touring"},VehicleDataRegion={na:"North America",eu:"Europe",jp:"Japan"},VehicleData={general:{brand:{id:"VDTSBrand",friendlyName:"Vehicle Brand",input:"list",values:VehicleDataBrand},type:{id:"VDTSVehicle_Type",friendlyName:"Vehicle Type",input:"list",values:VehicleDataVehicleType},region:{id:"SYSRegion",friendlyName:"Region",input:"list",values:VehicleDataRegion}},vehicle:{speed:{id:"VDTVehicleSpeed",friendlyName:"Vehicle Speed",input:"range",min:0,max:240,factor:.01},rpm:{id:"VDTEngineSpeed",friendlyName:"Engine RPM",input:"range",min:0,max:8e3,factor:2.25},odometer:{id:"VDTCOdocount",friendlyName:"Odocount"},batterylevel:{id:"VDTCBattery_StateOfCharge",friendlyName:"Battery Level"}},fuel:{position:{id:"VDTFuelGaugePosition",friendlyName:"Fuel Gauge Position"},averageconsumption:{id:"VDTDrv1AvlFuelE",friendlyName:"Average Fuel Consumption"}},engine:{brakefluidpressure:{id:"PIDBrakeFluidLineHydraulicPressure",friendlyName:"Brake Fluid Pressure"}},temperature:{outside:{id:"VDTCOut-CarTemperature",friendlyName:"Outside Temperature"},intake:{id:"VDTDR_IntakeAirTemp",friendlyName:"Intake Air Temperature"},coolant:{id:"PIDEngineCoolantTemperature",friendlyName:"Engine Coolant Temperature"}},gps:{latitude:{id:"GPSLatitude",friendlyName:"Latitude"},longitude:{id:"GPSLongitude",friendlyName:"Longitude"},altitude:{id:"GPSAltitude",friendlyName:"Altitude"},heading:{id:"GPSHeading",friendlyName:"Heading",input:"range",min:0,max:360,step:45},velocity:{id:"GPSVelocity",friendlyName:"Velocity"},timestamp:{id:"GPSTimestamp",friendlyName:"Timestamp"}}},CustomApplicationDataProcessors={vdtvehiclespeed:function(t){return Math.round(.01*t)},vdtenginespeed:function(t){return Math.round(2.25*t)}},CustomApplicationDataHandler={__name:"DataHandler",refreshRate:1e3,paused:!1,paths:{data:"apps/custom/data/casdk-"},tables:[{table:"sys",prefix:"SYS",enabled:!0,data:{region:{type:"string",value:"na"}},update:!1},{table:"vdt",prefix:"VDT",enabled:!0,file:!0,always:!0},{table:"gps",prefix:"GPS",enabled:!0,file:!0,filter:"gps",update:1},{table:"vdtpid",prefix:"PID",enabled:!0,file:!0,update:60},{table:"vdtcurrent",prefix:"VDTC",enabled:!0,file:!0,update:60},{table:"vdm",prefix:"VDM",enabled:!1,file:!0,update:300},{table:"vdmhistory",prefix:"VDMH",enabled:!1,file:!0,update:300},{table:"vdtsettings",prefix:"VDTS",enabled:!0,file:!0,update:!1},{table:"idm",prefix:"IDM",enabled:!0,file:!0,update:!1},{table:"idmhistory",prefix:"IDMH",enabled:!0,file:!0,update:!1},{table:"vdthistory",prefix:"VDTH",enabled:!1,file:!0,update:!1}],data:{},initialize:function(){this.initialized=!0,this.next()},get:function(t,e){CustomApplicationHelpers.is().object(t)&&(t=t.id);var t=t.toLowerCase();return this.data[t]?this.data[t]:{value:e?e:null}},getTableByPrefix:function(t){var e=!1;return this.tables.map(function(i){e||i.prefix!=t||(e=i)}),e},registerValue:function(t,e){if(e.name){var i=((t.prefix?t.prefix:"")+e.name).toLowerCase();return this.data[i]||(this.data[i]=$.extend({},e,{id:i,prefix:t.prefix,value:null,previous:null,changed:!1})),i}},setValue:function(t,e){this.data[t]&&(e=$.isNumeric(e)?parseInt(e)==e?parseInt(e):parseFloat(e):$.trim(e),CustomApplicationDataProcessors[t]&&(e=CustomApplicationDataProcessors[t](e)),this.data[t].changed=this.data[t].value!=e,this.data[t].previous=this.data[t].value,this.data[t].value=e,CustomApplicationsHandler.notifyDataChange(t,this.data[t]))},pause:function(){this.paused=!0},unpause:function(){this.paused=!1,this.next()},next:function(){clearTimeout(this.currentTimer),this.currentTimer=setTimeout(function(){this.paused||(CustomApplicationsHandler.currentApplicationId?this.retrieve():this.next())}.bind(this),this.refreshRate)},retrieve:function(t){var e=0,i=0,n=function(){e>=i&&(CustomApplicationHelpers.is().fn(t)&&t(this.data),this.next())}.bind(this);this.tables.map(function(t,s){var a=t.enabled&&(t.always||t.update||!t.update&&!t.__last);if(a&&t.update&&t.__last&&t.update>1&&(a=(new Date-t.__last)/1e3>t.update),a)switch(i++,!0){case CustomApplicationHelpers.is().object(t.data):$.each(t.data,function(e,i){i.name=e;var n=this.registerValue(t,i);i.value&&this.setValue(n,i.value)}.bind(this)),e++,this.tables[s].__last=new Date,n();break;case t.file:var o=this.paths.data+t.table;$.ajax(o,{timeout:t.always?null:250,success:function(e){this.__parseFileData(t,e),this.tables[s].__last=new Date}.bind(this),complete:function(){e++,n()}.bind(this)});break;default:CustomApplicationLog.error(this.__name,"Unsupported table type",{table:t.table}),e++,n()}}.bind(this))},__parseFileData:function(t,e){e=e.split("\n"),t.filter&&(e=this.__filterFileData(e,t.filter)),e.forEach(function(e,i){var n=e.split(/[\((,)\).*(:)]/);if(n.length>=5&&n[1])switch(n[1].toLowerCase()){case"binary":break;case"double":n[4]=n[4]+(n[5]?"."+n[5]:"");default:var s=this.registerValue(t,{name:$.trim(n[0]),type:$.trim(n[1])});this.setValue(s,$.trim(n[4]))}}.bind(this))},__filterFileData:function(t,e){switch(e){case"gps":var i=[],n={Timestamp:2,Latitude:3,Longitude:4,Altitude:5,Heading:6,Velocity:7};return $.each(n,function(e,n){if(t[n]){var s=$.trim(t[n]).split(" ");if(s[1]){var a="double"!=s[0]?"int":"double";i.push(e+" ("+a+", 4): "+$.trim(s[1]))}}}),i}}},DataTransform={toMPH:function(t){return Math.round(.621371*t)},toMPG:function(t){return Math.round(2.3521458*t)},scaleValue:function(t,e,i){return(t-e[0])*(i[1]-i[0])/(e[1]-e[0])+i[0]}},CustomApplicationHelpers={is:function(){return{undefined:"undefined",__toString:function(){return Object.prototype.toString.call(arguments[0])},iterable:function(){return this.object(arguments[0])||this.array(arguments[0])},fn:function(){return"function"==typeof arguments[0]},object:function(){return"object"==typeof arguments[0]},array:function(){return"[object Array]"===this.__toString(arguments[0])},date:function(){return"[object Date]"===this.__toString(arguments[0])},string:function(){return"string"==typeof arguments[0]},number:function(){return"number"==typeof arguments[0]},"boolean":function(){return"boolean"==typeof arguments[0]},defined:function(){return typeof arguments[0]!=this.undefined},element:function(){return typeof HTMLElement!==this.undefined?arguments[0]instanceof HTMLElement:arguments[0]&&1===arguments[0].nodeType},empty:function(t){switch(!0){case this.array(t)||this.string(t):return 0===t.length;case this.object(t):var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return 0===e;case this["boolean"](t):return t===!1;default:return!t}},same:function(t,e){return t==e}}},iterate:function(t,e){return this.is().object(t)?Object.keys(t).map(function(i){return e(i,t[i],!0)}):this.is().array(t)?t.map(function(t,i){return e(i,t)}):void 0},sprintr:function(){var t=Array.prototype.slice.call(arguments),e=arguments[0];t.shift();for(var i=0;i<t.length;i++)e=e.split("{"+i+"}").join(t[i]);return e}},CustomApplicationLog={levels:{debug:"DEBUG",info:"INFO",error:"ERROR"},enabledLogger:!1,enabledConsole:!1,enableLogger:function(t){this.enabledLogger=t},enableConsole:function(t){this.enabledConsole=t},debug:function(){this.__message(this.levels.debug,"#006600",Array.apply(null,arguments))},error:function(){this.__message(this.levels.error,"#FF0000",Array.apply(null,arguments))},info:function(){this.__message(this.levels.info,"#0000FF",Array.apply(null,arguments))},__message:function(t,e,i){if(this.enabledLogger||this.enabledConsole||"undefined"!=typeof DevLogger){var n=[];i.length>1&&i.forEach(function(t,e){if(e>0)switch(!0){case CustomApplicationHelpers.is().iterable(t):CustomApplicationHelpers.iterate(t,function(t,e,i){n.push(i?CustomApplicationHelpers.sprintr("[{0}={1}]",t,e):CustomApplicationHelpers.sprintr("[{0}]",e))});break;default:n.push(t)}});try{this.enabledLogger&&"undefined"!=typeof Logger&&Logger.log(t,i[0],n.join(" "),e),"undefined"!=typeof DevLogger&&DevLogger.log(t,i[0],n.join(" "),e)}catch(s){}try{enabledConsole&&console.log(CustomApplicationHelpers.sprintr("%c[{0}] [{1}] ",(new Date).toDateString(),i[0])+CustomApplicationHelpers.sprintr("%c{0}",n.join(" ")),"color:black",CustomApplicationHelpers.sprintr("color:{0}",e))}catch(s){}}}},CustomApplicationResourceLoader={__name:"ResourceLoader",loadJavascript:function(t,e,i,n,s){this.__loadInvoker(t,e,function(t,e){var i=document.createElement("script");i.type="text/javascript",i.src=t,i.onload=e,document.body.appendChild(i)},i,n,s)},loadCSS:function(t,e,i,n,s){this.__loadInvoker(t,e,function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,n.onload=s?i:e,document.body.appendChild(n)},i,n,s)},loadImages:function(t,e,i,n,s){this.__loadInvoker(t,e,function(t,e,n){var a=document.createElement("img");a.onload=function(){if(s){var t=!1;n&&(t={},t[n]=this),i(n?t:this)}else e(this)},a.src=t},i,n,s)},fromFormatted:function(t,e){return e.forEach(function(i,n){e[n]=CustomApplicationHelpers.sprintr(t,i)}),e},__loadInvoker:function(t,e,i,n,s,a){var o=!1,r=!1,s=s?s:{},l=!1;if(this.logger=CustomApplicationLog,CustomApplicationHelpers.is().object(t)){var u=t,o=[],t=[];Object.keys(u).map(function(e){o.push(e),t.push(u[e])}),r={}}else CustomApplicationHelpers.is().array(t)||(t=[t]);var c=0,h=function(e){c++,c>=t.length&&CustomApplicationHelpers.is().fn(n)&&n(r)};t.forEach(function(t,u){try{t=e+t,this.logger.debug(this.__name,"Attempting to load resource from",t),!a&&s.timeout&&(clearTimeout(l),l=setTimeout(function(){this.logger.error(this.__name,"Timeout occured while loading resource",t),h(!0)}.bind(this),s.timeout)),i(t,function(e){this.logger.info(this.__name,"Successfully loaded resource",t),e&&0!=o&&(this.logger.debug(this.__name,"Loaded resource assigned to id",{id:o[u],filename:t}),r[o[u]]=e),a?CustomApplicationHelpers.is().fn(n)&&n():h()}.bind(this),o?o[u]:!1)}catch(c){this.logger.error(this.__name,"Failed to load resource",{filename:t,error:c.message})}}.bind(this))}},CustomApplicationsHandler={__name:"ApplicationsHandler",applications:{},paths:{framework:"apps/custom/runtime/",applications:"apps/custom/apps/",vendor:"apps/custom/runtime/vendor/",surface:"apps/custom/runtime/surface/"},mapping:{},initialize:function(){this.initialized=!0,this.loader=CustomApplicationResourceLoader,this.log=CustomApplicationLog},retrieve:function(t){try{this.initialized||this.initialize(),this.loader.loadJavascript("jquery.js",this.paths.vendor,function(){this.loader.loadCSS("runtime.css",this.paths.framework,function(){this.loader.loadJavascript("apps.js",this.paths.applications,function(){"undefined"!=typeof CustomApplications&&this.loader.loadJavascript(this.loader.fromFormatted("{0}/app.js",CustomApplications),this.paths.applications,function(){CustomApplicationDataHandler.initialize(),t(this.getMenuItems())}.bind(this))}.bind(this))}.bind(this))}.bind(this))}catch(e){this.log.error(this.__name,"Error while retrieving applications",e),t(this.getMenuItems())}},get:function(t){return this.applications[t]?this.applications[t]:!1},register:function(t,e){return this.applications[t]&&(this.applications[t].__terminate(),this.applications[t]=!1),this.log.info(this.__name,{id:t},"Registering application"),e.id=t,e.location=this.paths.applications+t+"/",e.__initialize(),this.applications[t]=e,!0},launch:function(t){return this.log.info(this.__name,{id:t},"Launch request for application"),CustomApplicationHelpers.is().object(t)&&(t=t.appId?t.appId:!1),this.applications[t]?(this.currentApplicationId=t,this.log.info(this.__name,{id:t},"Launching application"),!0):(this.log.error(this.__name,{id:t},"Launch failed because application was not registered"),!1)},sleep:function(t){t.id==this.currentApplicationId&&(this.lastApplicationId=this.currentApplicationId,this.currentApplicationId=!1),t.__sleep()},getCurrentApplication:function(t){var e=this.currentApplicationId||(t?this.lastApplicationId:!1);return e?(this.log.debug(this.__name,"Invoking current set application",{id:e}),this.applications[e]?(this.currentApplicationId=e,this.applications[e]):(this.log.error(this.__name,"Application was not registered",{id:e}),!1)):(this.log.error(this.__name,"Missing currentApplicationId"),!1)},notifyDataChange:function(t,e){this.currentApplicationId&&this.applications[this.currentApplicationId]&&this.applications[this.currentApplicationId].__notify(t,e)},getMenuItems:function(t){return CustomApplicationHelpers.iterate(this.applications,function(t,e){return this.log.info(this.__name,{id:t},"Adding application to menu",{title:e.getTitle()}),{appData:{appName:e.getId(),appId:e.getId(),isVisible:!0,mmuiEvent:"SelectCustomApplication"},title:e.getTitle(),text1Id:e.getId().replace(".","_"),disabled:!1,itemStyle:"style02",hasCaret:e.getHasMenuCaret()}}.bind(this))}};